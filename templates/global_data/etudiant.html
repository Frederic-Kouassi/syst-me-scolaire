{% load static %}
{% load tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
{% include 'home/includes/base.html' %}
<body>
    <!-- Animated Background -->
    <div class="background"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="dashboard">
        <!-- Sidebar -->
        {% include 'home/includes/body.html' %}

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navbar -->
            <nav class="navbar">
                <div class="page-header">
                    <a href="{% url 'user' %}"><h1 class="page-title">Espace Étudiant</h1></a>
                    <div class="page-breadcrumb">
                        <a href="{% url 'index' %}">Dashboard</a>
                        <span>/</span>
                        <span>Analytics</span>
                    </div>
                </div>
                <div class="navbar-right">
                    <div class="search-box">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search students...">
                    </div>
                    <button class="nav-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="nav-btn" id="theme-toggle" title="Toggle Light/Dark Mode">
                        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/>
                            <path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/>
                            <path d="M2 12h2"/><path d="M20 12h2"/>
                            <path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/>
                        </svg>
                        <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </button>
                </div>
            </nav>

            <!-- Stats Cards -->
            <section class="stats-grid">
                <div class="glass-card glass-card-3d stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Total Étudiants</h3>
                            <div class="stat-value">{{inscrit}}</div>
                            <span class="stat-change positive">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline /></svg>
                                +18.2%
                            </span>
                        </div>
                        <div class="stat-icon cyan">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--emerald-light)" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="glass-card glass-card-3d stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Visiteurs Uniques</h3>
                            <div class="stat-value">{{visiteurs}}</div>
                            <span class="stat-change positive">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg>
                                +12.5%
                            </span>
                        </div>
                        <div class="stat-icon magenta">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="glass-card glass-card-3d stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Avg. Session</h3>
                            <div class="stat-value">4m 32s</div>
                            <span class="stat-change positive">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg>
                                +8.7%
                            </span>
                        </div>
                        <div class="stat-icon purple">
                            <svg viewBox="0 0 24 24" fill="none" stroke="var(--coral)" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                            </svg>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Charts Row -->
            <section class="content-grid" style="margin-bottom: 1.5rem;">
                <!-- Traffic Comparison Chart -->
                <div class="glass-card glass-card-3d">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Comparaison du Trafic</h2>
                            <p class="card-subtitle">Cette période vs période précédente</p>
                        </div>
                    </div>
                    <div class="chart-container" style="padding: 1.5rem; min-height: 300px;">
                        <div style="display: flex; gap: 1rem; height: 250px; align-items: flex-end; justify-content: space-around;">
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 90px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 120px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Lun</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 100px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 140px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Mar</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 85px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 110px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Mer</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 110px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 145px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Jeu</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 130px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 155px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Ven</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 75px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 95px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Sam</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end; width: 100%; justify-content: center;">
                                    <div style="width: 30px; height: 65px; background: rgba(255, 255, 255, 0.2); border-radius: 8px 8px 0 0;"></div>
                                    <div style="width: 30px; height: 85px; background: linear-gradient(180deg, var(--emerald-light), var(--emerald)); border-radius: 8px 8px 0 0;"></div>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Dim</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 1.5rem; justify-content: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 12px; height: 12px; background: linear-gradient(135deg, var(--emerald-light), var(--emerald)); border-radius: 3px;"></div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Cette période</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 12px; height: 12px; background: rgba(255, 255, 255, 0.2); border-radius: 3px;"></div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Période précédente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Traffic Sources -->
                <div class="glass-card glass-card-3d">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Sources de Trafic</h2>
                            <p class="card-subtitle">D'où viennent vos visiteurs</p>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;">
                            <div style="position: relative; width: 180px; height: 180px;">
                                <svg viewBox="0 0 36 36" style="transform: rotate(-90deg);">
                                    <circle cx="18" cy="18" r="15.9" fill="none" stroke="rgba(255, 255, 255, 0.1)" stroke-width="3"/>
                                    <circle cx="18" cy="18" r="15.9" fill="none" stroke="var(--emerald)" stroke-width="3" stroke-dasharray="42 100" stroke-dashoffset="0" stroke-linecap="round"/>
                                    <circle cx="18" cy="18" r="15.9" fill="none" stroke="var(--success)" stroke-width="3" stroke-dasharray="28 100" stroke-dashoffset="-42" stroke-linecap="round"/>
                                    <circle cx="18" cy="18" r="15.9" fill="none" stroke="var(--warning)" stroke-width="3" stroke-dasharray="18 100" stroke-dashoffset="-70" stroke-linecap="round"/>
                                    <circle cx="18" cy="18" r="15.9" fill="none" stroke="#A855F7" stroke-width="3" stroke-dasharray="12 100" stroke-dashoffset="-88" stroke-linecap="round"/>
                                </svg>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">45K</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Visiteurs</div>
                                </div>
                            </div>
                            <div style="flex: 1; min-width: 200px;">
                                <div style="margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-size: 0.875rem; color: var(--text-primary);">Direct</span>
                                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">42%</span>
                                    </div>
                                    <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                                        <div style="width: 42%; height: 100%; background: linear-gradient(90deg, var(--emerald-light), var(--emerald)); border-radius: 10px;"></div>
                                    </div>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-size: 0.875rem; color: var(--text-primary);">Recherche Organique</span>
                                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">28%</span>
                                    </div>
                                    <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                                        <div style="width: 28%; height: 100%; background: var(--success); border-radius: 10px;"></div>
                                    </div>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-size: 0.875rem; color: var(--text-primary);">Réseaux Sociaux</span>
                                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">18%</span>
                                    </div>
                                    <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                                        <div style="width: 18%; height: 100%; background: var(--warning); border-radius: 10px;"></div>
                                    </div>
                                </div>
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="font-size: 0.875rem; color: var(--text-primary);">Référence</span>
                                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">12%</span>
                                    </div>
                                    <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                                        <div style="width: 12%; height: 100%; background: #A855F7; border-radius: 10px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Students Table -->
            <section class="content-grid" style="grid-template-columns: 1fr;">
                <div class="glass-card table-card glass-card-3d" style="grid-column: span 1;">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Liste des Étudiants Inscrits</h2>
                            <p class="card-subtitle">Tous les étudiants actifs de cette période</p>
                        </div>
                        <div class="card-actions">
                            <button class="card-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export
                            </button>
                            <button class="card-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                Voir Tout
                            </button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom Étudiant</th>
                                    <th>Téléphone</th>
                                    <th>Email</th>
                                    <th>Enseignant(s)</th>
                                    <th>Classe</th>
                                    <th>Matières</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for eleve in etu_inscrit %}
                                <tr>
                                    <td>
                                        <div class="table-user">
                                            <div class="table-avatar" style="background: linear-gradient(135deg, var(--emerald-light), var(--emerald));">
                                                {{ eleve.etudiant.first_name|slice:":1"|upper }}{{ eleve.etudiant.last_name|slice:":1"|upper }}
                                            </div>
                                            <div class="table-user-info">
                                                <span class="table-user-name">{{ eleve.etudiant.last_name }}-{{ eleve.etudiant.first_name }}</span>
                                                <span class="table-user-email">
                                                    <a href="{% url 'login' %}" style="color: var(--emerald); text-decoration: none;">Voir profil</a>
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ eleve.etudiant.telephone }}</td>
                                    <td>{{ eleve.etudiant.email }}</td>
                                    <td>
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                            {% for enseignant in eleve.enseignants %}
                                                <span class="status-badge completed" style="font-size: 0.75rem;">{{ enseignant }}</span>
                                                {% if not forloop.last %} {% endif %}
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-badge pending">{{ eleve.classe }}</span>
                                    </td>
                                    <td>
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; max-width: 200px;">
                                            {% for matiere in eleve.matieres %}
                                                <span style="font-size: 0.75rem; padding: 0.25rem 0.5rem; background: rgba(255, 255, 255, 0.1); border-radius: 6px; color: var(--text-secondary);">{{ matiere }}</span>
                                                {% if not forloop.last %} {% endif %}
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <button class="card-btn" style="padding: 6px 12px; font-size: 0.85rem;">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                                </svg>
                                            </button>
                                            <button class="card-btn" style="padding: 6px 12px; font-size: 0.85rem; background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
    </button>

    <!-- Footer -->
    <footer class="site-footer">
        <p>Copyright © 2026 <a href="#" target="_blank" rel="nofollow">Gestion Étudiant</a> - Système de Gestion Scolaire</p>
    </footer>

    <script src="{% static 'js/templatemo-glass-admin-script.js' %}"></script>
    
    <style>
        /* Stabilité des éléments - empêcher tout mouvement */
        * {
            box-sizing: border-box;
        }
        
        .glass-card,
        .stat-card,
        .table-card {
            position: relative;
            transform: none !important;
            transition: none !important;
        }
        
        .glass-card-3d {
            transform: none !important;
        }
        
        .glass-card-3d:hover {
            transform: none !important;
        }
        
        /* Fixer le contenu des cartes */
        .card-header,
        .card-body,
        .table-wrapper,
        .chart-container {
            position: relative;
            width: 100%;
        }
        
        /* Stabiliser le tableau */
        .data-table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Largeurs fixes pour les colonnes du tableau */
        .data-table th:nth-child(1),
        .data-table td:nth-child(1) { width: 20%; }
        .data-table th:nth-child(2),
        .data-table td:nth-child(2) { width: 12%; }
        .data-table th:nth-child(3),
        .data-table td:nth-child(3) { width: 15%; }
        .data-table th:nth-child(4),
        .data-table td:nth-child(4) { width: 15%; }
        .data-table th:nth-child(5),
        .data-table td:nth-child(5) { width: 10%; }
        .data-table th:nth-child(6),
        .data-table td:nth-child(6) { width: 18%; }
        .data-table th:nth-child(7),
        .data-table td:nth-child(7) { width: 10%; }
        
        /* Fixer les avatars */
        .table-avatar {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
        }
        
        /* Stabiliser les badges */
        .status-badge {
            display: inline-block;
            white-space: nowrap;
        }
        
        /* Fixer les graphiques */
        .chart-container > div {
            width: 100%;
            height: auto;
        }
        
        /* Empêcher le débordement */
        .table-wrapper {
            overflow-x: auto;
            overflow-y: visible;
        }
        
        /* Fixer la grille des stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Fixer la grille de contenu */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Stabiliser les boutons */
        .card-btn {
            flex-shrink: 0;
        }
        
        /* Fixer les icônes */
        svg {
            flex-shrink: 0;
            display: block;
        }
        
        /* Empêcher le rétrécissement du contenu */
        .table-user-info {
            min-width: 0;
            overflow: hidden;
        }
        
        .table-user-name,
        .table-user-email {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Stabiliser les animations de l'arrière-plan seulement */
        .background,
        .orb {
            position: fixed;
            z-index: -1;
        }
        
        /* Tout le reste ne doit pas bouger */
        .dashboard,
        .main-content,
        .navbar,
        section {
            position: relative;
        }
    </style>
</body>
</html>